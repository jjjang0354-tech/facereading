
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ìƒìœ¼ë¡œ ë³´ëŠ” ìˆ˜ëŠ¥ ì„±ì í‘œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
* { box-sizing: border-box; }

body {
    font-family: 'Noto Serif KR', 'Malgun Gothic', serif;
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: radial-gradient(ellipse at center, #1a0505 0%, #0d0000 60%, #000 100%);
    overflow-x: hidden;
    position: relative;
}

/* ë°°ê²½ íŒ¨í„´ - ì „í†µ ë¬¸ì–‘ */
body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
        repeating-linear-gradient(
            45deg,
            rgba(180, 50, 0, 0.04) 0px,
            rgba(180, 50, 0, 0.04) 1px,
            transparent 1px,
            transparent 40px
        ),
        repeating-linear-gradient(
            -45deg,
            rgba(180, 50, 0, 0.04) 0px,
            rgba(180, 50, 0, 0.04) 1px,
            transparent 1px,
            transparent 40px
        );
    pointer-events: none;
    z-index: 0;
}

/* ë¶‰ì€ ì•ˆê°œ íš¨ê³¼ */
body::after {
    content: '';
    position: fixed;
    inset: 0;
    background:
        radial-gradient(ellipse 80% 50% at 20% 80%, rgba(150, 20, 0, 0.15) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 80% 20%, rgba(100, 10, 0, 0.12) 0%, transparent 60%),
        radial-gradient(ellipse 50% 60% at 50% 50%, rgba(80, 0, 0, 0.1) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
    animation: fogPulse 8s ease-in-out infinite alternate;
}

@keyframes fogPulse {
    0%   { opacity: 0.6; }
    100% { opacity: 1; }
}

/* ë– ë‹¤ë‹ˆëŠ” ë¶ˆê½ƒ íŒŒí‹°í´ */
.sparks-canvas {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1;
}

/* ìƒë‹¨ ì¥ì‹ ë¬¸êµ¬ */
.deco-top {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    text-align: center;
    padding: 10px;
    font-size: 0.75rem;
    color: rgba(200, 100, 0, 0.5);
    letter-spacing: 6px;
    z-index: 2;
    font-weight: 700;
}

/* ì¢Œìš° ì¥ì‹ */
.deco-side {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    writing-mode: vertical-rl;
    font-size: 0.8rem;
    color: rgba(180, 80, 0, 0.35);
    letter-spacing: 8px;
    z-index: 2;
    font-weight: 700;
    line-height: 1;
}
.deco-left  { left: 16px; }
.deco-right { right: 16px; }

/* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
.container {
    position: relative;
    z-index: 10;
    background: linear-gradient(160deg, rgba(30, 5, 0, 0.97) 0%, rgba(15, 2, 0, 0.98) 100%);
    border: 1px solid rgba(200, 100, 0, 0.4);
    border-radius: 4px;
    padding: 2.5rem 2rem;
    text-align: center;
    max-width: 560px;
    width: 90%;
    box-shadow:
        0 0 0 1px rgba(200, 100, 0, 0.15),
        0 0 30px rgba(180, 50, 0, 0.3),
        0 0 80px rgba(100, 20, 0, 0.2),
        inset 0 0 40px rgba(0,0,0,0.5);
}

/* ì»¨í…Œì´ë„ˆ ìƒë‹¨ ì¥ì‹ì„  */
.container::before {
    content: 'â—ˆ â”€â”€â”€â”€â”€â”€â”€ â˜¯ â”€â”€â”€â”€â”€â”€â”€ â—ˆ';
    display: block;
    color: rgba(200, 100, 0, 0.5);
    font-size: 0.7rem;
    letter-spacing: 3px;
    margin-bottom: 1.5rem;
}
.container::after {
    content: 'â—ˆ â”€â”€â”€â”€â”€â”€â”€ â˜¯ â”€â”€â”€â”€â”€â”€â”€ â—ˆ';
    display: block;
    color: rgba(200, 100, 0, 0.5);
    font-size: 0.7rem;
    letter-spacing: 3px;
    margin-top: 1.5rem;
}

/* í—¤ë” */
header h1 {
    font-size: 1.9rem;
    font-weight: 900;
    color: #e8a040;
    margin: 0 0 0.4rem;
    text-shadow:
        0 0 20px rgba(220, 120, 0, 0.8),
        0 0 40px rgba(180, 60, 0, 0.4);
    letter-spacing: 3px;
}

header .subtitle-deco {
    font-size: 0.72rem;
    color: rgba(180, 90, 0, 0.7);
    letter-spacing: 5px;
    margin-bottom: 0.5rem;
    display: block;
}

header p {
    color: rgba(210, 160, 80, 0.75);
    font-size: 0.88rem;
    margin-bottom: 2rem;
    line-height: 1.8;
    letter-spacing: 1px;
}

/* ì—…ë¡œë“œ ì„¹ì…˜ */
.upload-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.upload-section input[type="file"] {
    display: none;
}

.upload-section label {
    background: linear-gradient(135deg, rgba(160, 60, 0, 0.8), rgba(120, 30, 0, 0.9));
    color: #f0c060;
    padding: 0.85rem 2.2rem;
    border: 1px solid rgba(200, 100, 0, 0.5);
    border-radius: 2px;
    cursor: pointer;
    display: inline-block;
    font-size: 0.9rem;
    letter-spacing: 3px;
    font-weight: 700;
    font-family: 'Noto Serif KR', serif;
    transition: all 0.3s ease;
    box-shadow: 0 0 15px rgba(180, 60, 0, 0.3), inset 0 1px 0 rgba(255,200,100,0.1);
    position: relative;
    overflow: hidden;
}

.upload-section label::before {
    content: 'ğŸ”® ';
}

.upload-section label:hover {
    background: linear-gradient(135deg, rgba(200, 80, 0, 0.9), rgba(160, 50, 0, 1));
    box-shadow: 0 0 25px rgba(200, 80, 0, 0.5), inset 0 1px 0 rgba(255,200,100,0.2);
    color: #ffd580;
    transform: translateY(-1px);
}

#predict-button {
    background: linear-gradient(135deg, rgba(100, 10, 10, 0.9), rgba(60, 0, 0, 0.95));
    color: #e8a040;
    border: 1px solid rgba(200, 80, 0, 0.5);
    padding: 0.85rem 2.2rem;
    border-radius: 2px;
    cursor: pointer;
    font-size: 0.9rem;
    letter-spacing: 3px;
    font-weight: 700;
    font-family: 'Noto Serif KR', serif;
    transition: all 0.3s ease;
    box-shadow: 0 0 15px rgba(150, 30, 0, 0.3);
}

#predict-button::before {
    content: 'â˜¯ ';
}

#predict-button:hover {
    background: linear-gradient(135deg, rgba(140, 20, 20, 1), rgba(90, 5, 5, 1));
    box-shadow: 0 0 30px rgba(180, 50, 0, 0.5);
    color: #ffd580;
    transform: translateY(-1px);
}

.result-container {
    margin-top: 2rem;
}

.analyzing {
    font-size: 0.9rem;
    color: rgba(220, 160, 60, 0.9);
    padding: 1rem 1.2rem;
    background: rgba(80, 20, 0, 0.5);
    border: 1px solid rgba(180, 80, 0, 0.3);
    border-radius: 2px;
    letter-spacing: 1px;
    animation: pulse 1.2s ease-in-out infinite;
    text-shadow: 0 0 10px rgba(200, 100, 0, 0.5);
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* ì´›ë¶ˆ ì¥ì‹ */
.candle-row {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 1.5rem;
}

.candle {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.candle-flame {
    width: 8px;
    height: 14px;
    background: radial-gradient(ellipse at bottom, #fff9c4, #ffcc00 40%, #ff6600 70%, transparent);
    border-radius: 50% 50% 30% 30%;
    animation: flicker 0.8s ease-in-out infinite alternate;
    filter: drop-shadow(0 0 6px rgba(255,150,0,0.9));
}

.candle-body {
    width: 10px;
    height: 26px;
    background: linear-gradient(to bottom, #e8c060, #c09030);
    border-radius: 1px;
    box-shadow: 0 0 8px rgba(200,100,0,0.3);
}

@keyframes flicker {
    0%   { transform: scaleX(1)    scaleY(1)    rotate(-2deg); opacity: 0.95; }
    33%  { transform: scaleX(0.9)  scaleY(1.05) rotate(1deg);  opacity: 1;    }
    66%  { transform: scaleX(1.05) scaleY(0.95) rotate(-1deg); opacity: 0.9;  }
    100% { transform: scaleX(0.95) scaleY(1.02) rotate(2deg);  opacity: 1;    }
}
    </style>
</head>
<body>

    <!-- ì¥ì‹ ë¬¸êµ¬ -->
    <div class="deco-top">å¤© Â· åœ° Â· äºº Â· ç›¸ Â· æ³•</div>
    <div class="deco-side deco-left">ê´€ìƒì€ ê³¼í•™ì´ë‹¤</div>
    <div class="deco-side deco-right">ìš´ëª…ì„ ì½ëŠ”ë‹¤</div>

    <!-- ë¶ˆê½ƒ íŒŒí‹°í´ ìº”ë²„ìŠ¤ -->
    <canvas class="sparks-canvas" id="sparksCanvas"></canvas>

    <div class="container">
        <!-- ì´›ë¶ˆ ì¥ì‹ -->
        <div class="candle-row">
            <div class="candle">
                <div class="candle-flame" style="animation-delay:0s"></div>
                <div class="candle-body"></div>
            </div>
            <div class="candle">
                <div class="candle-flame" style="animation-delay:0.3s"></div>
                <div class="candle-body"></div>
            </div>
            <div class="candle">
                <div class="candle-flame" style="animation-delay:0.15s"></div>
                <div class="candle-body"></div>
            </div>
        </div>

        <header>
            <span class="subtitle-deco">â€” ì „í†µ ê´€ìƒí•™ ë¹„ì „ â€”</span>
            <h1>ê´€ìƒìœ¼ë¡œ ë³´ëŠ”<br>ìˆ˜ëŠ¥ ì„±ì í‘œ</h1>
            <p>ì‚¬ì§„ì„ ì˜¬ë¦¬ë©´<br>ì˜¤ì²œ ë…„ ë™ì–‘ ê´€ìƒí•™ì˜ ë¹„ë²•ìœ¼ë¡œ<br>ìˆ˜ëŠ¥ ì„±ì í‘œë¥¼ ì˜ˆì¸¡í•´ë“œë¦½ë‹ˆë‹¤.</p>
        </header>
        <main>
            <div class="upload-section">
                <input type="file" id="face-image" accept="image/*">
                <label for="face-image">ì‚¬ì§„ ì„ íƒ</label>
                <button id="predict-button">ê´€ìƒ ë³´ê¸°</button>
            </div>
            <div id="result-container" class="result-container"></div>
        </main>
    </div>
    <script>
// ë¶ˆê½ƒ íŒŒí‹°í´
(function() {
    const canvas = document.getElementById('sparksCanvas');
    const ctx = canvas.getContext('2d');
    let W, H;

    function resize() {
        W = canvas.width  = window.innerWidth;
        H = canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    const sparks = Array.from({ length: 55 }, () => makeSpark());

    function makeSpark() {
        return {
            x: Math.random() * (typeof W !== 'undefined' ? W : window.innerWidth),
            y: Math.random() * (typeof H !== 'undefined' ? H : window.innerHeight),
            r: Math.random() * 2 + 0.3,
            vx: (Math.random() - 0.5) * 0.4,
            vy: -(Math.random() * 0.7 + 0.2),
            alpha: Math.random(),
            decay: Math.random() * 0.008 + 0.003,
            hue: Math.random() * 30 + 15   // 15~45 (ì£¼í™©-ê¸ˆìƒ‰)
        };
    }

    function step() {
        ctx.clearRect(0, 0, W, H);
        for (const s of sparks) {
            s.x  += s.vx + Math.sin(Date.now() * 0.001 + s.y) * 0.3;
            s.y  += s.vy;
            s.alpha -= s.decay;
            if (s.alpha <= 0 || s.y < 0) {
                Object.assign(s, makeSpark(), { y: H + 5, alpha: Math.random() * 0.6 + 0.2 });
            }
            ctx.save();
            ctx.globalAlpha = Math.max(0, s.alpha);
            const grad = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r * 2);
            grad.addColorStop(0, `hsl(${s.hue}, 100%, 85%)`);
            grad.addColorStop(1, `hsla(${s.hue}, 100%, 50%, 0)`);
            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.r * 2, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
        requestAnimationFrame(step);
    }
    step();
})();
    </script>

    <script type="module">
// â”€â”€ score-report.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const PHYSIOGNOMY = {
    ì´ë§ˆ: {
        ë†’ìŒ: { í•´ì„: 'ìƒì •(ä¸Šåœ)ì´ ë„“ê³  ë¹›ë‚˜ ì‚¬ê³ ì˜ ê¸°ìš´ì´ ì¶©ë§Œí•¨',     ì„±í–¥: 'ìƒê°í˜• Â· ê³„íš ìš°ì„ ',   ë°ˆ: 'êµ­ì–´ ì§€ë¬¸ì„ ëê¹Œì§€ ì½ê³ ë„ ì‹œê°„ì´ ë‚¨ëŠ” íƒ€ì…' },
        ì¤‘ê°„: { í•´ì„: 'ìƒì •ì´ ê· í˜• ì¡í˜€ ì‚¬ê³ ì™€ í–‰ë™ì´ ê³ ë¦„',               ì„±í–¥: 'ê· í˜•í˜• Â· ìƒí™© ëŒ€ì‘',   ë°ˆ: '2ë…ì—ì„œ ê°‘ìê¸° ì´í•´ê°€ ì˜¤ëŠ” íƒ€ì…' },
        ë‚®ìŒ: { í•´ì„: 'ìƒì •ì˜ ê¸°ìš´ì´ ì‘ì¶•ë˜ì–´ í–‰ë™ ë³¸ëŠ¥ì´ ì•ì„¬',           ì„±í–¥: 'í–‰ë™í˜• Â· ì¦‰í¥ ëŒ€ì‘',   ë°ˆ: 'ì§€ë¬¸ ì½ê¸° ì „ ì„ ì§€ë¶€í„° í›‘ëŠ” ì „ëµê°€ íƒ€ì…' },
    },
    ëˆˆë§¤: {
        ë†’ìŒ: { í•´ì„: 'ì•ˆì‹ (çœ¼ç¥)ì´ ë˜ë ·í•˜ê³  ì§‘ì¤‘ì˜ ê¸°ìš´ì´ ê¹ŠìŒ',          ì„±í–¥: 'ë¶„ì„í˜• Â· ê¹Šì´ ì²˜ë¦¬',   ë°ˆ: 'í•œ ë¬¸ì œ 30ë¶„ ë¶™ì¡ê³  ê²°êµ­ ë§íˆëŠ” íƒ€ì…' },
        ì¤‘ê°„: { í•´ì„: 'ëˆˆë¹›ì´ ì•ˆì •ë˜ì–´ ë¹ ë¦„ê³¼ ê¹ŠìŒì´ ê· í˜•ì¡í˜',            ì„±í–¥: 'ê· í˜•í˜• Â· ì•ˆì • ì§‘ì¤‘',   ë°ˆ: '3ì ì§œë¦¬ëŠ” ë„˜ê¸°ê³  2ì ì§œë¦¬ ë‹¤ ë§íˆëŠ” í˜„ì‹¤ì£¼ì˜ íƒ€ì…' },
        ë‚®ìŒ: { í•´ì„: 'ëˆˆë§¤ê°€ ë¹ ë¥´ê³  ê°ê° ë°˜ì‘ì´ ë‚ ì¹´ë¡œì›€',                ì„±í–¥: 'ê°ê°í˜• Â· ë¹ ë¥¸ ë°˜ì‘',   ë°ˆ: 'ì§ê´€ ì°ê¸° ì •ë‹µë¥ ì´ ì˜ì™¸ë¡œ ë†’ì€ íƒ€ì…' },
    },
    ì½”: {
        ë†’ìŒ: { í•´ì„: 'ì¤€ë‘(æº–é ­)ê°€ ë†’ê³  ì‹¤í–‰ì˜ ê¸°ìš´ì´ ì¶©ë§Œí•¨',            ì„±í–¥: 'ëª©í‘œí˜• Â· ë†’ì€ ì¶”ì§„ë ¥', ë°ˆ: 'í‹€ë¦° ë¬¸ì œ ì´ìœ ë¥¼ ì˜¤ë‹µë…¸íŠ¸ 3ê¶Œì— ê¸°ë¡í•˜ëŠ” íƒ€ì…' },
        ì¤‘ê°„: { í•´ì„: 'ë¹„ëŸ‰(é¼»æ¢)ì´ ë°”ë¥´ê³  ì‹¤í–‰ê³¼ ì•ˆì •ì´ ê· í˜•ì¡í˜',        ì„±í–¥: 'ê· í˜•í˜• Â· ì•ˆì • ì‹¤í–‰',   ë°ˆ: 'ê³µë¶€ë„ í•˜ê³  ìœ íŠœë¸Œë„ ë³´ëŠ” ì ˆë¬˜í•œ ê· í˜• íƒ€ì…' },
        ë‚®ìŒ: { í•´ì„: 'ì½”ì˜ ê¸°ì„¸ê°€ ë¶€ë“œëŸ¬ì›Œ ì•ˆì • ì¶”êµ¬ ì„±í–¥ì´ ê°•í•¨',        ì„±í–¥: 'ì•ˆì •í˜• Â· ê¾¸ì¤€ ëˆ„ì ',   ë°ˆ: 'ìˆ˜ì—… í•„ê¸°ë§Œ ì™„ë²½í•´ë„ ë“±ê¸‰ì´ ë‚˜ì˜¤ëŠ” íƒ€ì…' },
    },
    ì…ìˆ : {
        ë†’ìŒ: { í•´ì„: 'êµ¬ê°(å£è§’)ì´ ëšœë ·í•˜ê³  í‘œí˜„ì˜ ê¸°ìš´ì´ ê°•í•¨',          ì„±í–¥: 'í‘œí˜„í˜• Â· ì–¸ì–´ ê°ê°',   ë°ˆ: "ë‹µ ì ìœ¼ë©´ì„œ í˜¼ì 'ë§ì§€?' í•˜ë©° ê³ ê°œ ë„ë•ì´ëŠ” íƒ€ì…" },
        ì¤‘ê°„: { í•´ì„: 'ì…ìˆ ì´ ê· í˜•ì¡í˜€ ë…¼ë¦¬ì™€ ê°ê°ì´ ì¡°í™”ë¡œì›€',            ì„±í–¥: 'ê· í˜•í˜• Â· ë…¼ë¦¬ì  í‘œí˜„', ë°ˆ: 'ì„ ì§€ ì½ë‹¤ ë³¸ëŠ¥ì ìœ¼ë¡œ ì •ë‹µì´ ëˆˆì— ë“¤ì–´ì˜¤ëŠ” íƒ€ì…' },
        ë‚®ìŒ: { í•´ì„: 'ìˆœë°•(è„£è–„)í•˜ê³  ë‚´í–¥ ë¶„ì„ ê¸°ì§ˆì´ ì„ ëª…í•¨',            ì„±í–¥: 'ë¶„ì„í˜• Â· ë‚´í–¥ì  ì‚¬ê³ ', ë°ˆ: 'ì¡°ìš©íˆ ê³µë¶€í•˜ë‹¤ ì‹œí—˜ì—ì„œ ë°˜ì „ ë³´ì—¬ì£¼ëŠ” íƒ€ì…' },
    },
    í„±: {
        ë†’ìŒ: { í•´ì„: 'ì§€ê°(åœ°é–£)ì´ ë„“ê³  ì§€ì†ì˜ ê¸°ìš´ì´ ë‘í…ê³  êµ³ìŒ',       ì„±í–¥: 'ì§€ì†í˜• Â· ì¥ê¸° ë‚´ê³µ',   ë°ˆ: 'ìˆ˜ëŠ¥ 3ë…„ ì¤€ë¹„í•´ë„ ì§€ì¹˜ì§€ ì•ŠëŠ” ì—­ì „ì˜ ìš©ì‚¬ íƒ€ì…' },
        ì¤‘ê°„: { í•´ì„: 'í•˜ì •(ä¸‹åœ)ì´ ì•ˆì •ì ì´ì–´ì„œ ì§€ì†ë ¥ì´ ê³ ë¦„',           ì„±í–¥: 'ê· í˜•í˜• Â· ì•ˆì • ì§€ì†',   ë°ˆ: '3ì£¼ í”Œëœ ì„¸ìš°ë©´ 2.5ì£¼ëŠ” ê¼­ ì§€í‚¤ëŠ” í˜„ì‹¤ íƒ€ì…' },
        ë‚®ìŒ: { í•´ì„: 'í„±ì´ ì˜ˆë¦¬í•˜ì—¬ ìˆœê°„ ì§‘ì¤‘ ê¸°ì§ˆì´ ê°•í•¨',               ì„±í–¥: 'ìˆœê°„í˜• Â· ë‹¨ê¸° ëª°ì…',   ë°ˆ: 'ìˆ˜ëŠ¥ ì „ë‚  ë°¤ìƒ˜ìœ¼ë¡œ 2ë“±ê¸‰ ë›°ì–´ì˜¤ë¥¼ ì ì¬ë ¥ ë³´ìœ ' },
    },
};

function getVariant(feature, brightness) {
    const variants = PHYSIOGNOMY[feature];
    if (!variants) return { í•´ì„: '-', ì„±í–¥: '-', ë°ˆ: '-' };
    if (brightness > 0.6)  return variants.ë†’ìŒ;
    if (brightness > 0.35) return variants.ì¤‘ê°„;
    return variants.ë‚®ìŒ;
}

class ScoreReport extends HTMLElement {
    constructor() {
        super();
        this.attachShadow({ mode: 'open' });
    }

    connectedCallback() {
        const studentName = this.getAttribute('student-name');
        const examNumber  = this.getAttribute('exam-number');
        const scores      = JSON.parse(this.getAttribute('scores'));

        const scoreRows = scores.map(s => {
            const std  = s.standardScore != null ? s.standardScore : '-';
            const pct  = s.percentile    != null ? s.percentile    : '-';
            return `
                <tr>
                    <td class="subject">${s.subject}</td>
                    <td class="elective">${s.elective}</td>
                    <td>${std}</td>
                    <td>${pct}</td>
                    <td class="grade g${s.grade}">${s.grade}</td>
                </tr>`;
        }).join('');

        const seen = new Set();
        const physiognomyRows = scores.filter(s => {
            if (seen.has(s.feature)) return false;
            seen.add(s.feature);
            return true;
        }).map(s => {
            const v = getVariant(s.feature, s.brightness ?? 0.5);
            return `
            <tr>
                <td class="feature-name">${s.feature}</td>
                <td class="feature-subject">${s.subject}${s.elective !== '-' ? ` (${s.elective})` : ''}</td>
                <td>
                    <div class="desc-wrap">
                        <div class="desc-í•´ì„">${v.í•´ì„}</div>
                        <div class="desc-row">
                            <span class="desc-ì„±í–¥">${v.ì„±í–¥}</span>
                            <span class="desc-ë°ˆ">${v.ë°ˆ}</span>
                        </div>
                    </div>
                </td>
            </tr>`;
        }).join('');

        this.shadowRoot.innerHTML = `
            <style>
                :host { display: block; font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; }

                .report {
                    border: 2px solid #1a3a6b;
                    border-radius: 10px;
                    overflow: hidden;
                    background: #fff;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.12);
                }

                /* â”€â”€ í—¤ë” â”€â”€ */
                .report-header {
                    background: linear-gradient(135deg, #1a3a6b, #2e5fac);
                    color: #fff;
                    padding: 16px;
                    text-align: center;
                }
                .report-header .title {
                    font-size: 1rem;
                    font-weight: bold;
                    letter-spacing: 1px;
                    margin-bottom: 4px;
                }
                .report-header .subtitle {
                    font-size: 0.75rem;
                    opacity: 0.8;
                }

                /* â”€â”€ ìˆ˜í—˜ìƒ ì •ë³´ â”€â”€ */
                .student-info {
                    display: flex;
                    border-bottom: 1px solid #c8d4e8;
                    background: #f0f4fb;
                }
                .student-info .cell {
                    flex: 1;
                    padding: 8px 14px;
                    font-size: 0.85rem;
                }
                .student-info .cell span {
                    color: #1a3a6b;
                    font-weight: bold;
                    margin-right: 6px;
                }
                .student-info .cell + .cell {
                    border-left: 1px solid #c8d4e8;
                }

                /* â”€â”€ ì„±ì  í…Œì´ë¸” â”€â”€ */
                table {
                    width: 100%;
                    border-collapse: collapse;
                    font-size: 0.88rem;
                }
                thead tr {
                    background: #e8edf8;
                    color: #1a3a6b;
                }
                th, td {
                    padding: 9px 10px;
                    border: 1px solid #c8d4e8;
                    text-align: center;
                }
                th { font-weight: bold; font-size: 0.82rem; }
                td.subject  { font-weight: 600; color: #1a3a6b; }
                td.elective { text-align: left; color: #555; font-size: 0.82rem; }

                .grade { font-weight: bold; font-size: 1rem; }
                .g1 { color: #c0392b; }
                .g2 { color: #e67e22; }
                .g3 { color: #d4ac0d; }
                .g4 { color: #27ae60; }
                .g5 { color: #2980b9; }
                .g6 { color: #8e44ad; }
                .g7, .g8, .g9 { color: #95a5a6; }

                /* â”€â”€ ê´€ìƒ ë¶„ì„ â”€â”€ */
                .physio-section {
                    border-top: 2px solid #c8d4e8;
                    background: #fdf8f0;
                }
                .physio-title {
                    background: linear-gradient(135deg, #6b3a1a, #ac5f2e);
                    color: #fff;
                    padding: 10px 14px;
                    font-size: 0.88rem;
                    font-weight: bold;
                    letter-spacing: 1px;
                }
                .physio-table th { background: #f5ede0; color: #6b3a1a; }
                .feature-name    { font-weight: bold; color: #6b3a1a; white-space: nowrap; }
                .feature-subject { color: #555; white-space: nowrap; font-size: 0.8rem; }

                .desc-wrap  { display: flex; flex-direction: column; gap: 4px; text-align: left; }
                .desc-í•´ì„  { color: #333; font-size: 0.8rem; }
                .desc-row   { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
                .desc-ì„±í–¥  { font-size: 0.72rem; background: #e8edf8; color: #1a3a6b;
                               padding: 1px 7px; border-radius: 10px; font-weight: bold; white-space: nowrap; }
                .desc-ë°ˆ    { font-size: 0.75rem; color: #888; font-style: italic; }

                .footer {
                    font-size: 0.72rem;
                    color: #999;
                    padding: 8px 14px;
                    text-align: right;
                    border-top: 1px solid #e0e0e0;
                    background: #fafafa;
                }
            </style>

            <div class="report">
                <div class="report-header">
                    <div class="title">2025í•™ë…„ë„ ëŒ€í•™ìˆ˜í•™ëŠ¥ë ¥ì‹œí—˜ ì„±ì í†µì§€í‘œ</div>
                    <div class="subtitle">AI ì „í†µ ê´€ìƒí•™ ê¸°ë°˜ ì˜ˆì¸¡</div>
                </div>

                <div class="student-info">
                    <div class="cell"><span>ìˆ˜í—˜ë²ˆí˜¸</span>${examNumber}</div>
                    <div class="cell"><span>ì„±ëª…</span>${studentName}</div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>ì˜ì—­</th>
                            <th>ì„ íƒê³¼ëª©</th>
                            <th>í‘œì¤€ì ìˆ˜</th>
                            <th>ë°±ë¶„ìœ„</th>
                            <th>ë“±ê¸‰</th>
                        </tr>
                    </thead>
                    <tbody>${scoreRows}</tbody>
                </table>

                <div class="physio-section">
                    <div class="physio-title">ğŸ”® ê´€ìƒ ì†Œê²¬ â€” í•™ìŠµ ì„±í–¥ ë¶„ì„</div>
                    <table class="physio-table">
                        <thead>
                            <tr>
                                <th>ê´€ìƒ ë¶€ìœ„</th>
                                <th>ì—°ê´€ ì˜ì—­</th>
                                <th>ê´€ìƒ ì†Œê²¬</th>
                            </tr>
                        </thead>
                        <tbody>${physiognomyRows}</tbody>
                    </table>
                </div>

                <div class="footer">â€» ë³¸ ê²°ê³¼ëŠ” ì „í†µ ê´€ìƒí•™ì„ í™œìš©í•œ AI ì˜ˆì¸¡ìœ¼ë¡œ, ì‹¤ì œ ì„±ì ê³¼ ë¬´ê´€í•©ë‹ˆë‹¤.</div>
            </div>
        `;
    }
}

customElements.define('score-report', ScoreReport);

// â”€â”€ main.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function getRegionBrightness(ctx, x, y, w, h) {
    const data = ctx.getImageData(
        Math.floor(x), Math.floor(y),
        Math.max(1, Math.floor(w)), Math.max(1, Math.floor(h))
    ).data;
    let total = 0;
    for (let i = 0; i < data.length; i += 4) {
        total += (data[i] + data[i + 1] + data[i + 2]) / 3;
    }
    return total / (data.length / 4) / 255; // 0~1 ì •ê·œí™”
}

function analyzeImage(file) {
    return new Promise((resolve) => {
        const img = new Image();
        const url = URL.createObjectURL(file);
        img.onload = () => {
            const canvas = document.createElement('canvas');
            canvas.width = 100;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, 100, 100);
            URL.revokeObjectURL(url);
            resolve({
                ì´ë§ˆ: getRegionBrightness(ctx, 10,  0, 80, 20),
                ëˆˆ:   getRegionBrightness(ctx,  5, 20, 90, 20),
                ì½”:   getRegionBrightness(ctx, 25, 40, 50, 20),
                ì…:   getRegionBrightness(ctx, 15, 60, 70, 15),
                í„±:   getRegionBrightness(ctx, 20, 75, 60, 15),
            });
        };
        img.src = url;
    });
}

function weighted(brightness, min, max) {
    const range = max - min;
    const base = min + range * brightness;
    const noise = (Math.random() - 0.5) * range * 0.25;
    return Math.round(Math.min(max, Math.max(min, base + noise)));
}

function percentileToGrade(p) {
    if (p >= 96) return 1;
    if (p >= 89) return 2;
    if (p >= 77) return 3;
    if (p >= 60) return 4;
    if (p >= 40) return 5;
    if (p >= 23) return 6;
    if (p >= 11) return 7;
    if (p >= 4)  return 8;
    return 9;
}

function brightnessToAbsGrade(brightness) {
    return Math.max(1, Math.min(9, Math.round(9 - brightness * 8 + (Math.random() - 0.5) * 1.5)));
}

const EXPLORE_SOCIAL = ['ìƒí™œê³¼ ìœ¤ë¦¬', 'ìœ¤ë¦¬ì™€ ì‚¬ìƒ', 'í•œêµ­ì§€ë¦¬', 'ì„¸ê³„ì§€ë¦¬', 'ë™ì•„ì‹œì•„ì‚¬', 'ì„¸ê³„ì‚¬', 'ê²½ì œ', 'ì •ì¹˜ì™€ ë²•', 'ì‚¬íšŒÂ·ë¬¸í™”'];
const EXPLORE_SCIENCE = ['ë¬¼ë¦¬í•™â… ', 'í™”í•™â… ', 'ìƒëª…ê³¼í•™â… ', 'ì§€êµ¬ê³¼í•™â… '];

function generateScores(f) {
    const korPct  = weighted(f.ì´ë§ˆ, 1, 99);
    const mathPct = weighted(f.ëˆˆ,   1, 99);
    const exp1Pct = weighted(f.ì…,   1, 99);
    const exp2Pct = weighted(f.ì…,   1, 99);

    return [
        {
            subject: 'êµ­ì–´', elective: 'í™”ë²•ê³¼ ì‘ë¬¸',
            standardScore: weighted(f.ì´ë§ˆ, 100, 150), percentile: korPct,
            grade: percentileToGrade(korPct), feature: 'ì´ë§ˆ', brightness: f.ì´ë§ˆ,
        },
        {
            subject: 'ìˆ˜í•™', elective: 'í™•ë¥ ê³¼ í†µê³„',
            standardScore: weighted(f.ëˆˆ, 100, 149), percentile: mathPct,
            grade: percentileToGrade(mathPct), feature: 'ëˆˆë§¤', brightness: f.ëˆˆ,
        },
        {
            subject: 'ì˜ì–´', elective: '-',
            standardScore: null, percentile: null,
            grade: brightnessToAbsGrade(f.ì½”), feature: 'ì½”', brightness: f.ì½”,
        },
        {
            subject: 'í•œêµ­ì‚¬', elective: '-',
            standardScore: null, percentile: null,
            grade: brightnessToAbsGrade(f.í„±), feature: 'í„±', brightness: f.í„±,
        },
        {
            subject: 'íƒêµ¬',
            elective: EXPLORE_SOCIAL[Math.floor(Math.random() * EXPLORE_SOCIAL.length)],
            standardScore: weighted(f.ì…, 50, 75), percentile: exp1Pct,
            grade: percentileToGrade(exp1Pct), feature: 'ì…ìˆ ', brightness: f.ì…,
        },
        {
            subject: 'íƒêµ¬',
            elective: EXPLORE_SCIENCE[Math.floor(Math.random() * EXPLORE_SCIENCE.length)],
            standardScore: weighted(f.ì…, 50, 75), percentile: exp2Pct,
            grade: percentileToGrade(exp2Pct), feature: 'ì…ìˆ ', brightness: f.ì…,
        },
    ];
}

const STEPS = [
    { icon: 'ğŸ”®', text: 'ë™ì–‘ 5ì²œ ë…„ ê´€ìƒí•™ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì† ì¤‘...' },
    { icon: 'ğŸ“', text: 'ì´ë§ˆ ë©´ì ì„ mmÂ² ë‹¨ìœ„ë¡œ ì •ë°€ ì¸¡ì •í•˜ì—¬ êµ­ì–´ ì ìˆ˜ë¡œ í™˜ì‚° ì¤‘...' },
    { icon: 'ğŸ‘ï¸', text: 'ëˆˆë¹›ì—ì„œ ê¸°ì¶œë¬¸ì œ í’€ì´ íšŸìˆ˜ë¥¼ ì—­ì¶”ì‚° ì¤‘ (ìˆ˜í•™)' },
    { icon: 'ğŸ‘ƒ', text: 'ì½§êµ¬ë© í™©ê¸ˆë¹„ìœ¨ì„ ì˜ì–´ ë“£ê¸° ëŠ¥ë ¥ì¹˜ë¡œ ë³€í™˜ ì¤‘...' },
    { icon: 'ğŸ‘„', text: 'ì¸ì¤‘ ê¹Šì´ë¡œ ê³µì‹ ì•”ê¸°ëŸ‰ì„ ì¶”ì •í•˜ëŠ” ì¤‘ (íƒêµ¬)' },
    { icon: 'ğŸ›ï¸', text: 'í„±ì˜ ë‚´êµ¬ì„±ì´ í•œêµ­ì‚¬ ì—°í‘œë¥¼ ë²„í‹¸ ìˆ˜ ìˆëŠ”ì§€ ê²€ì¦ ì¤‘...' },
    { icon: 'ğŸ“œ', text: 'ìˆ˜ëŠ¥ ì¶œì œìœ„ì›íšŒì— ëª°ë˜ ì œì¶œ... ì•„ë‹ˆ, ìµœì¢… ì„±ì ì„ ì‚°ì¶œ ì¤‘' },
];

async function runAnalysis(file, resultContainer) {
    for (const step of STEPS) {
        resultContainer.innerHTML = `<p class="analyzing">${step.icon} ${step.text}</p>`;
        await new Promise(r => setTimeout(r, 550));
    }

    const features = await analyzeImage(file);
    const scores = generateScores(features);

    resultContainer.innerHTML = '';
    const scoreReport = document.createElement('score-report');
    scoreReport.setAttribute('student-name', 'í™ê¸¸ë™');
    scoreReport.setAttribute('exam-number', '10000101');
    scoreReport.setAttribute('scores', JSON.stringify(scores));
    resultContainer.appendChild(scoreReport);
}

document.getElementById('predict-button').addEventListener('click', () => {
    const fileInput = document.getElementById('face-image');
    const resultContainer = document.getElementById('result-container');

    if (fileInput.files.length === 0) {
        alert('ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }

    runAnalysis(fileInput.files[0], resultContainer);
});
    </script>
</body>
</html>
